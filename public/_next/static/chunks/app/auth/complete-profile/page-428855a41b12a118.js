(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[737],{53696:(e,t,a)=>{"use strict";a.d(t,{B:()=>s});var r=a(74219);class s{static async createUser(e){let t=new Date().toISOString();return await r.LL.createDocument(r.AH,r.WU.USERS,e.userId,{...e,createdAt:t,updatedAt:t})}static async getUser(e){return await r.LL.getDocument(r.AH,r.WU.USERS,e)}static async updateUser(e,t){return await r.LL.updateDocument(r.AH,r.WU.USERS,e,{...t,updatedAt:new Date().toISOString()})}static async getUserByEmail(e){try{return(await r.LL.listDocuments(r.AH,r.WU.USERS,[r.XK.equal("email",e)])).documents[0]||null}catch(e){return null}}static async getUserByUsername(e){try{return(await r.LL.listDocuments(r.AH,r.WU.USERS,[r.XK.equal("username",e)])).documents[0]||null}catch(e){return null}}static async createWallet(e){let t=r.ID.unique(),a=await r.LL.createDocument(r.AH,r.WU.WALLETS,t,{...e,walletName:e.name,walletAddress:e.address,walletId:t,createdAt:new Date().toISOString()});return a.name=a.walletName,a.address=a.walletAddress,a}static async getUserWallets(e){return(await r.LL.listDocuments(r.AH,r.WU.WALLETS,[r.XK.equal("userId",e),r.XK.equal("isActive",!0),r.XK.orderDesc("createdAt")])).documents.map(e=>({...e,name:e.walletName||e.name,address:e.walletAddress||e.address}))}static async getWallet(e){return await r.LL.getDocument(r.AH,r.WU.WALLETS,e)}static async updateWallet(e,t){return await r.LL.updateDocument(r.AH,r.WU.WALLETS,e,t)}static async setDefaultWallet(e,t){let a=await this.getUserWallets(e);return await Promise.all(a.map(e=>this.updateWallet(e.walletId,{isDefault:!1}))),await this.updateWallet(t,{isDefault:!0})}static async getTokens(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return(await r.LL.listDocuments(r.AH,r.WU.TOKENS,[r.XK.equal("isActive",!0),r.XK.orderAsc("name"),r.XK.limit(e)])).documents}static async getToken(e){return await r.LL.getDocument(r.AH,r.WU.TOKENS,e)}static async getTokenBySymbol(e){try{return(await r.LL.listDocuments(r.AH,r.WU.TOKENS,[r.XK.equal("symbol",e)])).documents[0]||null}catch(e){return null}}static async createTransaction(e){let t=r.ID.unique();return await r.LL.createDocument(r.AH,r.WU.TRANSACTIONS,t,{...e,transactionId:t,createdAt:new Date().toISOString()})}static async getUserTransactions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return(await r.LL.listDocuments(r.AH,r.WU.TRANSACTIONS,[r.XK.or([r.XK.equal("fromUserId",e),r.XK.equal("toUserId",e)]),r.XK.orderDesc("createdAt"),r.XK.limit(t)])).documents}static async getTransaction(e){return await r.LL.getDocument(r.AH,r.WU.TRANSACTIONS,e)}static async updateTransaction(e,t){return await r.LL.updateDocument(r.AH,r.WU.TRANSACTIONS,e,t)}static async createPaymentRequest(e){let t=r.ID.unique();return await r.LL.createDocument(r.AH,r.WU.PAYMENT_REQUESTS,t,{...e,requestId:t,createdAt:new Date().toISOString()})}static async getUserPaymentRequests(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sent";return(await r.LL.listDocuments(r.AH,r.WU.PAYMENT_REQUESTS,[r.XK.equal("sent"===t?"fromUserId":"toUserId",e),r.XK.orderDesc("createdAt")])).documents}static async getPaymentRequest(e){return await r.LL.getDocument(r.AH,r.WU.PAYMENT_REQUESTS,e)}static async updatePaymentRequest(e,t){await r.LL.updateDocument(r.AH,r.WU.PAYMENT_REQUESTS,e,t)}static async getPaymentRequestByInvoice(e){let t=await r.LL.listDocuments(r.AH,r.WU.PAYMENT_REQUESTS,[r.XK.equal("invoiceNumber",e)]);if(0===t.documents.length)throw Error("Payment request not found");return t.documents[0]}static async getExchangeRates(){return(await r.LL.listDocuments(r.AH,r.WU.EXCHANGE_RATES,[r.XK.equal("isActive",!0),r.XK.orderDesc("lastUpdated")])).documents}static async getExchangeRate(e,t){try{return(await r.LL.listDocuments(r.AH,r.WU.EXCHANGE_RATES,[r.XK.equal("fromCurrency",e),r.XK.equal("toCurrency",t),r.XK.equal("isActive",!0)])).documents[0]||null}catch(e){return null}}static async createSecurityLog(e){let t=r.ID.unique();return await r.LL.createDocument(r.AH,r.WU.SECURITY_LOGS,t,{...e,logId:t,createdAt:new Date().toISOString()})}static async getUserSecurityLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return(await r.LL.listDocuments(r.AH,r.WU.SECURITY_LOGS,[r.XK.equal("userId",e),r.XK.orderDesc("createdAt"),r.XK.limit(t)])).documents}static async createAPIKey(e){let t=r.ID.unique();return await r.LL.createDocument(r.AH,r.WU.API_KEYS,t,{...e,keyId:t,createdAt:new Date().toISOString()})}static async getUserAPIKeys(e){return(await r.LL.listDocuments(r.AH,r.WU.API_KEYS,[r.XK.equal("userId",e),r.XK.orderDesc("createdAt")])).documents}static async updateAPIKey(e,t){return await r.LL.updateDocument(r.AH,r.WU.API_KEYS,e,t)}static async deactivateAPIKey(e){return await this.updateAPIKey(e,{isActive:!1})}}},74219:(e,t,a)=>{"use strict";a.d(t,{AH:()=>c,ID:()=>r.ID,LL:()=>i,WU:()=>l,XK:()=>r.XK,ct:()=>n});var r=a(69960);let s=new r.Kj;s.setEndpoint("https://fra.cloud.appwrite.io/v1").setProject("68399b0c0018d6ce71bc");let n=new r.gD(s),i=new r.Lv(s);new r.wc(s);let c="683a31960011608eaee5",l={USERS:"users",WALLETS:"wallets",TOKENS:"tokens",TRANSACTIONS:"transactions",PAYMENT_REQUESTS:"payment_requests",EXCHANGE_RATES:"exchange_rates",SECURITY_LOGS:"security_logs",API_KEYS:"api_keys"}},81070:(e,t,a)=>{Promise.resolve().then(a.bind(a,98536))},85430:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AuthProvider:()=>l,useAuth:()=>u});var r=a(74807),s=a(95423),n=a(53696),i=a(74219);let c=(0,s.createContext)(void 0);function l(e){let{children:t}=e,[a,l]=(0,s.useState)(null),[u,o]=(0,s.useState)(null),[d,m]=(0,s.useState)(!0),y=e=>e.split("@")[0].toLowerCase().replace(/[^a-z0-9]/g,""),h=async e=>{try{let t=await n.B.getUser(e.$id);if(t)return o(t),t}catch(e){console.log("Creating new user profile...")}try{let t=y(e.email),a={userId:e.$id,email:e.email,username:t,displayName:e.name||t,kycStatus:"pending",kycLevel:0,twoFactorEnabled:!1,isActive:!0,preferredCurrency:"USD"},r=await n.B.createUser(a);return o(r),await n.B.createSecurityLog({userId:e.$id,action:"profile_created",ipAddress:"unknown",success:!0,riskScore:0}),r}catch(e){throw console.error("Failed to create user profile:",e),e}},A=async()=>{if(a)try{let e=await n.B.getUser(a.$id);o(e)}catch(e){console.error("Failed to refresh profile:",e)}},w=async(e,t)=>{m(!0);try{await i.ct.createEmailPasswordSession(e,t);let a=await i.ct.get();l(a),await h(a),await n.B.createSecurityLog({userId:a.$id,action:"login_success",ipAddress:"unknown",success:!0,riskScore:0})}catch(t){if(e)try{let t=await n.B.getUserByEmail(e);t&&await n.B.createSecurityLog({userId:t.userId,action:"login_failed",ipAddress:"unknown",success:!1,riskScore:3})}catch(e){console.error("Failed to log security event:",e)}throw t}finally{m(!1)}},p=async(e,t,a)=>{m(!0);try{await i.ct.create("unique()",e,t,a),await i.ct.createEmailPasswordSession(e,t);let r=await i.ct.get();l(r),await h(r)}catch(e){throw e}finally{m(!1)}},S=async()=>{try{a&&await n.B.createSecurityLog({userId:a.$id,action:"logout",ipAddress:"unknown",success:!0,riskScore:0}),await i.ct.deleteSession("current"),l(null),o(null)}catch(e){console.error("Logout failed:",e)}};return(0,s.useEffect)(()=>{(async()=>{m(!0);try{let e=await i.ct.get();l(e),await h(e)}catch(e){l(null),o(null)}finally{m(!1)}})()},[]),(0,r.jsx)(c.Provider,{value:{user:a,userProfile:u,isLoading:d,login:w,register:p,logout:S,refreshProfile:A},children:t})}function u(){let e=(0,s.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},93095:(e,t,a)=>{"use strict";var r=a(9103);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},98536:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var r=a(74807),s=a(95423),n=a(99847),i=a(93095);function c(e){var t;let{className:a}=e,{user:c,completeProfile:l}=(0,n.A)(),u=(0,i.useRouter)(),[o,d]=(0,s.useState)(!1),[m,y]=(0,s.useState)({username:(null==c||null==(t=c.email)?void 0:t.split("@")[0])||"",displayName:(null==c?void 0:c.name)||"",email:(null==c?void 0:c.email)||""}),h=async e=>{if(e.preventDefault(),!m.username||!m.displayName||!m.email)return void alert("Please fill in all required fields");d(!0);try{await l(m),u.push("/dashboard")}catch(e){console.error("Profile completion failed:",e),alert("Failed to complete profile. Please try again.")}finally{d(!1)}},A=e=>{let{name:t,value:a}=e.target;y(e=>({...e,[t]:a}))};return(0,r.jsx)("div",{className:"max-w-md mx-auto ".concat(a),children:(0,r.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-md",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-center mb-6",children:"Complete Your Profile"}),(0,r.jsx)("p",{className:"text-gray-600 text-center mb-6",children:"Please provide the following information to complete your account setup."}),(0,r.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),(0,r.jsx)("input",{id:"email",name:"email",type:"email",required:!0,value:m.email,onChange:A,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"your.email@example.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:"Username *"}),(0,r.jsx)("input",{id:"username",name:"username",type:"text",required:!0,value:m.username,onChange:A,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Choose a unique username",pattern:"[a-zA-Z0-9_]+",title:"Username can only contain letters, numbers, and underscores"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Name *"}),(0,r.jsx)("input",{id:"displayName",name:"displayName",type:"text",required:!0,value:m.displayName,onChange:A,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Your display name"})]}),(0,r.jsx)("button",{type:"submit",disabled:o,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Completing Profile...":"Complete Profile"})]})]})})}function l(e){let{children:t,requireAuth:a=!0,redirectTo:c="/auth/login"}=e,{isLoading:l,isAuthenticated:u,isGuest:o,needsProfileCompletion:d}=(0,n.A)(),m=(0,i.useRouter)(),y=(0,i.usePathname)();return((0,s.useEffect)(()=>{if(a&&!l){if(!u&&!o)return void m.push(c);if(u&&!o&&d&&"/auth/complete-profile"!==y)return void m.push("/auth/complete-profile");if(u&&!o&&!d&&"/auth/complete-profile"===y)return void m.push("/home")}},[l,u,o,d,y,m,a,c]),a)?l?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):o||u&&!o&&!d||u&&!o&&d&&"/auth/complete-profile"===y?(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):(0,r.jsx)(r.Fragment,{children:t})}function u(){return(0,r.jsx)(l,{requireAuth:!1,children:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,r.jsx)(c,{})})})}},99847:(e,t,a)=>{"use strict";a.d(t,{A:()=>r.useAuth,O:()=>r.AuthProvider});var r=a(85430)}},e=>{var t=t=>e(e.s=t);e.O(0,[960,412,640,358],()=>t(81070)),_N_E=e.O()}]);
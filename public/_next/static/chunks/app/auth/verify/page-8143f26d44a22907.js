(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[67],{53696:(e,t,a)=>{"use strict";a.d(t,{B:()=>s});var r=a(74219);class s{static async createUser(e){let t=new Date().toISOString();return await r.LL.createDocument(r.AH,r.WU.USERS,e.userId,{...e,createdAt:t,updatedAt:t})}static async getUser(e){return await r.LL.getDocument(r.AH,r.WU.USERS,e)}static async updateUser(e,t){return await r.LL.updateDocument(r.AH,r.WU.USERS,e,{...t,updatedAt:new Date().toISOString()})}static async getUserByEmail(e){try{return(await r.LL.listDocuments(r.AH,r.WU.USERS,[r.XK.equal("email",e)])).documents[0]||null}catch(e){return null}}static async getUserByUsername(e){try{return(await r.LL.listDocuments(r.AH,r.WU.USERS,[r.XK.equal("username",e)])).documents[0]||null}catch(e){return null}}static async createWallet(e){let t=r.ID.unique(),a=await r.LL.createDocument(r.AH,r.WU.WALLETS,t,{...e,walletName:e.name,walletAddress:e.address,walletId:t,createdAt:new Date().toISOString()});return a.name=a.walletName,a.address=a.walletAddress,a}static async getUserWallets(e){return(await r.LL.listDocuments(r.AH,r.WU.WALLETS,[r.XK.equal("userId",e),r.XK.equal("isActive",!0),r.XK.orderDesc("createdAt")])).documents.map(e=>({...e,name:e.walletName||e.name,address:e.walletAddress||e.address}))}static async getWallet(e){return await r.LL.getDocument(r.AH,r.WU.WALLETS,e)}static async updateWallet(e,t){return await r.LL.updateDocument(r.AH,r.WU.WALLETS,e,t)}static async setDefaultWallet(e,t){let a=await this.getUserWallets(e);return await Promise.all(a.map(e=>this.updateWallet(e.walletId,{isDefault:!1}))),await this.updateWallet(t,{isDefault:!0})}static async getTokens(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return(await r.LL.listDocuments(r.AH,r.WU.TOKENS,[r.XK.equal("isActive",!0),r.XK.orderAsc("name"),r.XK.limit(e)])).documents}static async getToken(e){return await r.LL.getDocument(r.AH,r.WU.TOKENS,e)}static async getTokenBySymbol(e){try{return(await r.LL.listDocuments(r.AH,r.WU.TOKENS,[r.XK.equal("symbol",e)])).documents[0]||null}catch(e){return null}}static async createTransaction(e){let t=r.ID.unique();return await r.LL.createDocument(r.AH,r.WU.TRANSACTIONS,t,{...e,transactionId:t,createdAt:new Date().toISOString()})}static async getUserTransactions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return(await r.LL.listDocuments(r.AH,r.WU.TRANSACTIONS,[r.XK.or([r.XK.equal("fromUserId",e),r.XK.equal("toUserId",e)]),r.XK.orderDesc("createdAt"),r.XK.limit(t)])).documents}static async getTransaction(e){return await r.LL.getDocument(r.AH,r.WU.TRANSACTIONS,e)}static async updateTransaction(e,t){return await r.LL.updateDocument(r.AH,r.WU.TRANSACTIONS,e,t)}static async createPaymentRequest(e){let t=r.ID.unique();return await r.LL.createDocument(r.AH,r.WU.PAYMENT_REQUESTS,t,{...e,requestId:t,createdAt:new Date().toISOString()})}static async getUserPaymentRequests(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sent";return(await r.LL.listDocuments(r.AH,r.WU.PAYMENT_REQUESTS,[r.XK.equal("sent"===t?"fromUserId":"toUserId",e),r.XK.orderDesc("createdAt")])).documents}static async getPaymentRequest(e){return await r.LL.getDocument(r.AH,r.WU.PAYMENT_REQUESTS,e)}static async updatePaymentRequest(e,t){await r.LL.updateDocument(r.AH,r.WU.PAYMENT_REQUESTS,e,t)}static async getPaymentRequestByInvoice(e){let t=await r.LL.listDocuments(r.AH,r.WU.PAYMENT_REQUESTS,[r.XK.equal("invoiceNumber",e)]);if(0===t.documents.length)throw Error("Payment request not found");return t.documents[0]}static async getExchangeRates(){return(await r.LL.listDocuments(r.AH,r.WU.EXCHANGE_RATES,[r.XK.equal("isActive",!0),r.XK.orderDesc("lastUpdated")])).documents}static async getExchangeRate(e,t){try{return(await r.LL.listDocuments(r.AH,r.WU.EXCHANGE_RATES,[r.XK.equal("fromCurrency",e),r.XK.equal("toCurrency",t),r.XK.equal("isActive",!0)])).documents[0]||null}catch(e){return null}}static async createSecurityLog(e){let t=r.ID.unique();return await r.LL.createDocument(r.AH,r.WU.SECURITY_LOGS,t,{...e,logId:t,createdAt:new Date().toISOString()})}static async getUserSecurityLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return(await r.LL.listDocuments(r.AH,r.WU.SECURITY_LOGS,[r.XK.equal("userId",e),r.XK.orderDesc("createdAt"),r.XK.limit(t)])).documents}static async createAPIKey(e){let t=r.ID.unique();return await r.LL.createDocument(r.AH,r.WU.API_KEYS,t,{...e,keyId:t,createdAt:new Date().toISOString()})}static async getUserAPIKeys(e){return(await r.LL.listDocuments(r.AH,r.WU.API_KEYS,[r.XK.equal("userId",e),r.XK.orderDesc("createdAt")])).documents}static async updateAPIKey(e,t){return await r.LL.updateDocument(r.AH,r.WU.API_KEYS,e,t)}static async deactivateAPIKey(e){return await this.updateAPIKey(e,{isActive:!1})}}},74219:(e,t,a)=>{"use strict";a.d(t,{AH:()=>c,ID:()=>r.ID,LL:()=>i,WU:()=>u,XK:()=>r.XK,ct:()=>n});var r=a(69960);let s=new r.Kj;s.setEndpoint("https://fra.cloud.appwrite.io/v1").setProject("68399b0c0018d6ce71bc");let n=new r.gD(s),i=new r.Lv(s);new r.wc(s);let c="683a31960011608eaee5",u={USERS:"users",WALLETS:"wallets",TOKENS:"tokens",TRANSACTIONS:"transactions",PAYMENT_REQUESTS:"payment_requests",EXCHANGE_RATES:"exchange_rates",SECURITY_LOGS:"security_logs",API_KEYS:"api_keys"}},79102:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var r=a(74807),s=a(95423),n=a(93095),i=a(99847),c=a(63909),u=a(30760),l=a(67138),o=a.n(l);function d(e){let{children:t}=e;return(0,r.jsx)(r.Fragment,{children:t})}function m(e){let{children:t}=e;return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}),children:(0,r.jsx)(d,{children:t})})}function y(){let e=(0,n.useSearchParams)(),t=(0,n.useRouter)(),{verifyEmail:a}=(0,i.A)(),[l,d]=(0,s.useState)("verifying"),[m,y]=(0,s.useState)("");(0,s.useEffect)(()=>{let t=null==e?void 0:e.get("userId"),a=null==e?void 0:e.get("secret");t&&a?w(t,a):(d("error"),y("Invalid verification link"))},[e]);let w=async(e,r)=>{try{await a(e,r),d("success"),setTimeout(()=>{t.push("/")},3e3)}catch(e){d("error"),y(e.message||"Email verification failed")}};return(0,r.jsx)("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("div",{className:"max-w-md w-full space-y-8",children:(0,r.jsx)(c.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center",children:(0,r.jsxs)("div",{className:"bg-white py-8 px-6 shadow-sm rounded-lg border border-neutral-200",children:["verifying"===l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.TwU,{className:"mx-auto h-12 w-12 text-primary-600 animate-spin"}),(0,r.jsx)("h2",{className:"mt-4 text-2xl font-bold text-neutral-900",children:"Verifying your email..."}),(0,r.jsx)("p",{className:"mt-2 text-sm text-neutral-600",children:"Please wait while we verify your email address."})]}),"success"===l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mx-auto h-12 w-12 bg-green-100 rounded-full flex items-center justify-center",children:(0,r.jsx)(u.YrT,{className:"h-6 w-6 text-green-600"})}),(0,r.jsx)("h2",{className:"mt-4 text-2xl font-bold text-neutral-900",children:"Email verified successfully!"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-neutral-600",children:"Your email has been verified. You'll be redirected to your dashboard shortly."}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)(o(),{href:"/",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Go to Dashboard"})})]}),"error"===l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mx-auto h-12 w-12 bg-red-100 rounded-full flex items-center justify-center",children:(0,r.jsx)(u.yGN,{className:"h-6 w-6 text-red-600"})}),(0,r.jsx)("h2",{className:"mt-4 text-2xl font-bold text-neutral-900",children:"Verification failed"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-neutral-600",children:m}),(0,r.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,r.jsx)(o(),{href:"/auth/login",className:"w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Back to Login"}),(0,r.jsx)(o(),{href:"/auth/signup",className:"w-full inline-flex justify-center items-center px-4 py-2 border border-neutral-300 text-sm font-medium rounded-md text-neutral-700 bg-white hover:bg-neutral-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Create New Account"})]})]})]})})})})}function w(){return(0,r.jsx)(m,{children:(0,r.jsx)(y,{})})}},85024:(e,t,a)=>{Promise.resolve().then(a.bind(a,79102))},85430:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AuthProvider:()=>u,useAuth:()=>l});var r=a(74807),s=a(95423),n=a(53696),i=a(74219);let c=(0,s.createContext)(void 0);function u(e){let{children:t}=e,[a,u]=(0,s.useState)(null),[l,o]=(0,s.useState)(null),[d,m]=(0,s.useState)(!0),y=e=>e.split("@")[0].toLowerCase().replace(/[^a-z0-9]/g,""),w=async e=>{try{let t=await n.B.getUser(e.$id);if(t)return o(t),t}catch(e){console.log("Creating new user profile...")}try{let t=y(e.email),a={userId:e.$id,email:e.email,username:t,displayName:e.name||t,kycStatus:"pending",kycLevel:0,twoFactorEnabled:!1,isActive:!0,preferredCurrency:"USD"},r=await n.B.createUser(a);return o(r),await n.B.createSecurityLog({userId:e.$id,action:"profile_created",ipAddress:"unknown",success:!0,riskScore:0}),r}catch(e){throw console.error("Failed to create user profile:",e),e}},h=async()=>{if(a)try{let e=await n.B.getUser(a.$id);o(e)}catch(e){console.error("Failed to refresh profile:",e)}},A=async(e,t)=>{m(!0);try{await i.ct.createEmailPasswordSession(e,t);let a=await i.ct.get();u(a),await w(a),await n.B.createSecurityLog({userId:a.$id,action:"login_success",ipAddress:"unknown",success:!0,riskScore:0})}catch(t){if(e)try{let t=await n.B.getUserByEmail(e);t&&await n.B.createSecurityLog({userId:t.userId,action:"login_failed",ipAddress:"unknown",success:!1,riskScore:3})}catch(e){console.error("Failed to log security event:",e)}throw t}finally{m(!1)}},f=async(e,t,a)=>{m(!0);try{await i.ct.create("unique()",e,t,a),await i.ct.createEmailPasswordSession(e,t);let r=await i.ct.get();u(r),await w(r)}catch(e){throw e}finally{m(!1)}},g=async()=>{try{a&&await n.B.createSecurityLog({userId:a.$id,action:"logout",ipAddress:"unknown",success:!0,riskScore:0}),await i.ct.deleteSession("current"),u(null),o(null)}catch(e){console.error("Logout failed:",e)}};return(0,s.useEffect)(()=>{(async()=>{m(!0);try{let e=await i.ct.get();u(e),await w(e)}catch(e){u(null),o(null)}finally{m(!1)}})()},[]),(0,r.jsx)(c.Provider,{value:{user:a,userProfile:l,isLoading:d,login:A,register:f,logout:g,refreshProfile:h},children:t})}function l(){let e=(0,s.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},93095:(e,t,a)=>{"use strict";var r=a(9103);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},99847:(e,t,a)=>{"use strict";a.d(t,{A:()=>r.useAuth,O:()=>r.AuthProvider});var r=a(85430)}},e=>{var t=t=>e(e.s=t);e.O(0,[215,960,898,909,412,640,358],()=>t(85024)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[620],{14353:(e,t,a)=>{"use strict";a.d(t,{O:()=>s.useTransaction});var s=a(68080)},18547:(e,t,a)=>{"use strict";a.r(t),a.d(t,{PaymentRequestProvider:()=>l,usePaymentRequest:()=>o});var s=a(74807),r=a(95423),n=a(53696),i=a(99847);let c=(0,r.createContext)(void 0);function l(e){let{children:t}=e,{user:a}=(0,i.A)(),[l,o]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),m=async()=>{if(!a){o([]),u(!1);return}u(!0);try{let e=await n.B.getUserPaymentRequests(a.$id);o(e)}catch(e){console.error("Failed to fetch payment requests:",e),o([])}finally{u(!1)}},h=async e=>{if(!a)throw Error("User not authenticated");try{let t="INV-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,8).toUpperCase()),s=e.dueDate||new Date(Date.now()+6048e5).toISOString(),r=await n.B.createPaymentRequest({fromUserId:a.$id,toEmail:e.toEmail,tokenId:e.tokenId,amount:e.amount,description:e.description,dueDate:s,status:"pending",invoiceNumber:t});return await n.B.createSecurityLog({userId:a.$id,action:"payment_request_created",ipAddress:"unknown",success:!0,riskScore:1,metadata:JSON.stringify({requestId:r.requestId,amount:e.amount,tokenId:e.tokenId,invoiceNumber:t})}),await m(),r}catch(e){throw console.error("Failed to create payment request:",e),e}},x=async(e,t)=>{try{await n.B.updatePaymentRequest(e,{status:"paid",paymentTxId:t,paidAt:new Date().toISOString()}),await n.B.createSecurityLog({userId:a.$id,action:"payment_request_paid",ipAddress:"unknown",success:!0,riskScore:0,metadata:JSON.stringify({requestId:e,transactionId:t})}),await m()}catch(e){throw console.error("Failed to pay payment request:",e),e}},p=async e=>{try{await n.B.updatePaymentRequest(e,{status:"cancelled"}),await n.B.createSecurityLog({userId:a.$id,action:"payment_request_cancelled",ipAddress:"unknown",success:!0,riskScore:0,metadata:JSON.stringify({requestId:e})}),await m()}catch(e){throw console.error("Failed to cancel payment request:",e),e}};return(0,r.useEffect)(()=>{m()},[a]),(0,s.jsx)(c.Provider,{value:{paymentRequests:l,isLoading:d,createPaymentRequest:h,payPaymentRequest:x,cancelPaymentRequest:p,refreshPaymentRequests:m,getActiveRequests:()=>l.filter(e=>"pending"===e.status),getPaidRequests:()=>l.filter(e=>"paid"===e.status)},children:t})}function o(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("usePaymentRequest must be used within a PaymentRequestProvider");return e}},34712:(e,t,a)=>{"use strict";a.d(t,{v:()=>s.useWallet});var s=a(86033)},35714:(e,t,a)=>{"use strict";a.d(t,{i:()=>s.useExchangeRate});var s=a(62189)},49969:(e,t,a)=>{"use strict";a.d(t,{G:()=>r});var s=a(74807);function r(e){let{children:t}=e;return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsx)("main",{children:t})})}a(95423)},53845:(e,t,a)=>{Promise.resolve().then(a.bind(a,75127))},62189:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ExchangeRateProvider:()=>c,useExchangeRate:()=>l});var s=a(74807),r=a(95423);class n{static async getExchangeRate(e){let t=this.cache.get(e);if(t&&Date.now()-t.timestamp<this.CACHE_DURATION)return t.rate;try{let t=this.TOKEN_MAPPING[e.toLowerCase()];if(!t)return console.warn("No CoinGecko mapping for token: ".concat(e)),this.getMockRate(e);let a=await fetch("".concat(this.COINGECKO_API,"/simple/price?ids=").concat(t,"&vs_currencies=usd&include_24hr_change=true"),{headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4)});if(!a.ok)throw Error("HTTP ".concat(a.status));let s=(await a.json())[t];if(!s)throw Error("No price data for ".concat(t));let r={tokenId:e.toLowerCase(),symbol:e.toUpperCase(),name:this.getTokenName(e),price_usd:s.usd,price_change_24h:s.usd_24h_change||0,last_updated:new Date().toISOString()};return this.cache.set(e,{rate:r,timestamp:Date.now()}),r}catch(t){return console.error("Failed to fetch exchange rate for ".concat(e,":"),t),this.getMockRate(e)}}static async getMultipleExchangeRates(e){let t=[...new Set(e.map(e=>e.toLowerCase()))],a=t.map(e=>this.TOKEN_MAPPING[e]).filter(Boolean);if(0===a.length)return t.map(e=>this.getMockRate(e)).filter(Boolean);try{let e=await fetch("".concat(this.COINGECKO_API,"/simple/price?ids=").concat(a.join(","),"&vs_currencies=usd&include_24hr_change=true"),{headers:{Accept:"application/json"},signal:AbortSignal.timeout(15e3)});if(!e.ok)throw Error("HTTP ".concat(e.status));let s=await e.json(),r=[];for(let e of t){let t=s[this.TOKEN_MAPPING[e]];if(t){let a={tokenId:e,symbol:e.toUpperCase(),name:this.getTokenName(e),price_usd:t.usd,price_change_24h:t.usd_24h_change||0,last_updated:new Date().toISOString()};this.cache.set(e,{rate:a,timestamp:Date.now()}),r.push(a)}else{let t=this.getMockRate(e);t&&r.push(t)}}return r}catch(e){return console.error("Failed to fetch multiple exchange rates:",e),t.map(e=>this.getMockRate(e)).filter(Boolean)}}static calculateUsdValue(e,t,a){let s="string"==typeof e?parseFloat(e):e;if(isNaN(s))return 0;if(a)return s*a.price_usd;let r=this.getMockRate(t);return r?s*r.price_usd:0}static formatUsdValue(e){return e>=1e6?"$".concat((e/1e6).toFixed(2),"M"):e>=1e3?"$".concat((e/1e3).toFixed(2),"K"):"$".concat(e.toFixed(2))}static formatPriceChange(e){let t=e>=0;return{text:"".concat(t?"+":"").concat(e.toFixed(2),"%"),color:t?"text-green-600":"text-red-600"}}static getMockRate(e){let t={btc:{price:43e3,name:"Bitcoin"},eth:{price:2400,name:"Ethereum"},matic:{price:.85,name:"Polygon"},bnb:{price:310,name:"BNB"},usdt:{price:1,name:"Tether"},usdc:{price:1,name:"USD Coin"},ada:{price:.45,name:"Cardano"},sol:{price:95,name:"Solana"},dot:{price:7.2,name:"Polkadot"},avax:{price:35,name:"Avalanche"}}[e.toLowerCase()];return t?{tokenId:e.toLowerCase(),symbol:e.toUpperCase(),name:t.name,price_usd:t.price,price_change_24h:(Math.random()-.5)*10,last_updated:new Date().toISOString()}:null}static getTokenName(e){return({btc:"Bitcoin",eth:"Ethereum",matic:"Polygon",bnb:"BNB",usdt:"Tether",usdc:"USD Coin",ada:"Cardano",sol:"Solana",dot:"Polkadot",avax:"Avalanche"})[e.toLowerCase()]||e.toUpperCase()}static clearCache(){this.cache.clear()}static getCacheSize(){return this.cache.size}}n.COINGECKO_API="https://api.coingecko.com/api/v3",n.CACHE_DURATION=3e5,n.cache=new Map,n.TOKEN_MAPPING={btc:"bitcoin",eth:"ethereum",matic:"matic-network",bnb:"binancecoin",usdt:"tether",usdc:"usd-coin",ada:"cardano",sol:"solana",dot:"polkadot",avax:"avalanche-2"};let i=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[a,c]=(0,r.useState)({}),[l,o]=(0,r.useState)(!1),[d,u]=(0,r.useState)(null),m=["btc","eth","matic","bnb","usdt","usdc"],h=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m;o(!0);try{let t=await n.getMultipleExchangeRates(e),a={};t.forEach(e=>{a[e.tokenId]=e}),c(e=>({...e,...a})),u(new Date)}catch(e){console.error("Failed to refresh exchange rates:",e)}finally{o(!1)}},x=e=>a[e.toLowerCase()]||null;return(0,r.useEffect)(()=>{h();let e=setInterval(()=>{h()},3e5);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{let e=()=>{!document.hidden&&d&&Date.now()-d.getTime()>12e4&&h()};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[d]),(0,s.jsx)(i.Provider,{value:{rates:a,isLoading:l,lastUpdated:d,refreshRates:h,getRate:x,calculateUsdValue:(e,t)=>{let a=x(t);return n.calculateUsdValue(e,t,a||void 0)},formatUsdValue:e=>n.formatUsdValue(e),formatPriceChange:e=>n.formatPriceChange(e)},children:t})}function l(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useExchangeRate must be used within an ExchangeRateProvider");return e}},68080:(e,t,a)=>{"use strict";a.r(t),a.d(t,{TransactionProvider:()=>c,useTransaction:()=>l});var s=a(74807),r=a(95423),n=a(53696);let i=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[a,c]=(0,r.useState)([]),[l,o]=(0,r.useState)(!1),d=async()=>{o(!0);try{let e=await n.B.getUserTransactions("current-user-id");c(e)}catch(e){console.error("Failed to load transactions:",e)}finally{o(!1)}},u=async e=>{try{let t=await n.B.createTransaction(e);return await d(),t.transactionId}catch(e){throw console.error("Failed to send transaction:",e),e}},m=async()=>{await d()};return(0,r.useEffect)(()=>{d()},[]),(0,s.jsx)(i.Provider,{value:{transactions:a,isLoading:l,sendTransaction:u,getTransactionsByWallet:e=>a.filter(t=>t.fromWalletId===e||t.toAddress===e),refreshTransactions:m},children:t})}function l(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useTransaction must be used within a TransactionProvider");return e}},75127:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var s=a(74807),r=a(95423),n=a(99847),i=a(34712),c=a(14353),l=a(81010),o=a(35714),d=a(30760);function u(e){let{className:t="",showRefresh:a=!1}=e,{rates:r,isLoading:n,lastUpdated:i,refreshRates:c,formatPriceChange:l}=(0,o.i)();return(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-neutral-200 p-6 ".concat(t),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-neutral-900",children:"Live Prices"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)("span",{className:"text-xs text-neutral-500",children:["Updated ",(()=>{if(!i)return"Never";let e=Math.floor((new Date().getTime()-i.getTime())/6e4);if(e<1)return"Just now";if(e<60)return"".concat(e,"m ago");let t=Math.floor(e/60);return t<24?"".concat(t,"h ago"):i.toLocaleDateString()})()]}),a&&(0,s.jsx)("button",{onClick:()=>{c()},disabled:n,className:"p-1 text-neutral-400 hover:text-neutral-600 disabled:animate-spin",children:(0,s.jsx)(d.jTZ,{className:"w-4 h-4"})})]})]}),(0,s.jsx)("div",{className:"space-y-3",children:Object.values(r).slice(0,6).map(e=>{let t=l(e.price_change_24h),a=e.price_change_24h>=0;return(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-cyan-500 to-blue-600 flex items-center justify-center text-white text-sm font-bold",children:e.symbol.slice(0,2)}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-neutral-900",children:e.symbol}),(0,s.jsx)("div",{className:"text-sm text-neutral-500",children:e.name})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"font-medium text-neutral-900",children:["$",e.price_usd.toLocaleString(void 0,{minimumFractionDigits:e.price_usd<1?4:2,maximumFractionDigits:e.price_usd<1?6:2})]}),(0,s.jsxs)("div",{className:"text-sm flex items-center ".concat(t.color),children:[a?(0,s.jsx)(d.ARf,{className:"w-3 h-3 mr-1"}):(0,s.jsx)(d.JW4,{className:"w-3 h-3 mr-1"}),t.text]})]})]},e.tokenId)})}),n&&(0,s.jsx)("div",{className:"mt-4 text-center text-sm text-neutral-500",children:(0,s.jsxs)("div",{className:"inline-flex items-center",children:[(0,s.jsx)(d.jTZ,{className:"w-4 h-4 mr-2 animate-spin"}),"Updating prices..."]})})]})}var m=a(49969),h=a(67138),x=a.n(h),p=a(93095);function f(){var e;let{user:t,userProfile:a,isAuthenticated:h,isLoading:f}=(0,n.A)(),{wallets:g,defaultWallet:v,isLoading:j}=(0,i.v)(),{transactions:N}=(0,c.O)(),{paymentRequests:w,getActiveRequests:y,getPaidRequests:b}=(0,l.z)(),{calculateUsdValue:P,formatUsdValue:_,getRate:k}=(0,o.i)(),[C,S]=(0,r.useState)(0),E=(0,p.useRouter)();return((0,r.useEffect)(()=>{f||h||E.push("/")},[h,f,E]),(0,r.useEffect)(()=>{if(h&&g.length>0){let e=0;g.forEach(t=>{var a;let s=parseFloat((null==(a=t.balance)?void 0:a.toString())||"0");if(s>0){let a=P(s,t.blockchain);e+=a}}),S(e)}},[g,P,h]),f)?(0,s.jsx)(m.G,{children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-cyan-600"})})}):(0,s.jsx)(m.G,{children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold text-neutral-900 mb-2",children:["Welcome back, ",(null==a?void 0:a.displayName)||(null==a||null==(e=a.email)?void 0:e.split("@")[0])||(null==t?void 0:t.name)||"User","!"]}),(0,s.jsx)("p",{className:"text-neutral-600",children:"Manage your crypto wallets and transactions"})]}),(0,s.jsx)("div",{className:"bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-xl p-6 mb-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-cyan-100 mb-2",children:"Total Portfolio Balance"}),(0,s.jsx)("h2",{className:"text-4xl font-bold",children:_(C)}),(0,s.jsxs)("p",{className:"text-cyan-100 mt-2",children:[g.length," ",1===g.length?"Wallet":"Wallets"]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"p-3 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:(0,s.jsx)(d.jTZ,{className:"w-6 h-6"})})})]})}),(0,s.jsxs)("div",{className:"grid md:grid-cols-4 gap-6 mb-8",children:[(0,s.jsxs)(x(),{href:"/send",className:"bg-gradient-to-br from-cyan-500 to-blue-600 text-white rounded-xl p-6 hover:from-cyan-600 hover:to-blue-700 transition-all group",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)(d.kGk,{className:"w-8 h-8"}),(0,s.jsx)(d.dyV,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Send Money"}),(0,s.jsx)("p",{className:"text-cyan-100",children:"Send crypto to any wallet address"})]}),(0,s.jsxs)(x(),{href:"/receive",className:"bg-gradient-to-br from-green-500 to-emerald-600 text-white rounded-xl p-6 hover:from-green-600 hover:to-emerald-700 transition-all group",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)(d.a4x,{className:"w-8 h-8"}),(0,s.jsx)(d.dyV,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Receive Money"}),(0,s.jsx)("p",{className:"text-green-100",children:"Get your wallet address and QR code"})]}),(0,s.jsxs)(x(),{href:"/requests/create",className:"bg-gradient-to-br from-purple-500 to-pink-600 text-white rounded-xl p-6 hover:from-purple-600 hover:to-pink-700 transition-all group",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)(d.PjK,{className:"w-8 h-8"}),(0,s.jsx)(d.dyV,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Request Payment"}),(0,s.jsx)("p",{className:"text-purple-100",children:"Create invoices and payment requests"})]}),(0,s.jsxs)(x(),{href:"/wallets/create",className:"bg-gradient-to-br from-orange-500 to-red-600 text-white rounded-xl p-6 hover:from-orange-600 hover:to-red-700 transition-all group",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)(d.GGD,{className:"w-8 h-8"}),(0,s.jsx)(d.dyV,{className:"w-5 h-5 group-hover:translate-x-1 transition-transform"})]}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Add Wallet"}),(0,s.jsx)("p",{className:"text-orange-100",children:"Create or import a new wallet"})]})]}),y().length>0&&(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-neutral-200 p-6 mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-neutral-900",children:"Recent Payment Requests"}),(0,s.jsx)(x(),{href:"/requests",className:"text-cyan-600 hover:text-cyan-700 text-sm font-medium",children:"View All"})]}),(0,s.jsx)("div",{className:"space-y-4",children:y().slice(0,3).map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-neutral-100 pb-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-full bg-yellow-100",children:(0,s.jsx)(d.PjK,{className:"w-4 h-4 text-yellow-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-neutral-900",children:e.invoiceNumber}),(0,s.jsx)("div",{className:"text-sm text-neutral-500",children:e.description||"Payment request"})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"font-medium text-neutral-900",children:[e.amount," ",e.tokenId.toUpperCase()]}),(0,s.jsx)("div",{className:"text-xs px-2 py-1 rounded-full bg-yellow-100 text-yellow-700",children:"pending"})]})]},e.requestId))})]}),(0,s.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm border border-neutral-200 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-neutral-900",children:"Recent Transactions"}),(0,s.jsx)(x(),{href:"/transactions",className:"text-cyan-600 hover:text-cyan-700 text-sm font-medium",children:"View All"})]}),0===N.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-neutral-500",children:"No transactions yet"}),(0,s.jsxs)(x(),{href:"/send",className:"inline-flex items-center mt-4 px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors",children:[(0,s.jsx)(d.kGk,{className:"w-4 h-4 mr-2"}),"Send Your First Payment"]})]}):(0,s.jsx)("div",{className:"space-y-4",children:N.slice(0,5).map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-neutral-100 pb-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-full ".concat("send"===e.type?"bg-red-100":"bg-green-100"),children:(0,s.jsx)(d.kGk,{className:"w-4 h-4 ".concat("send"===e.type?"text-red-600":"text-green-600")})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-neutral-900",children:"send"===e.type?"Sent":"Received"}),(0,s.jsx)("div",{className:"text-sm text-neutral-500",children:e.description||"".concat(e.type," transaction")})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"font-medium ".concat("send"===e.type?"text-red-600":"text-green-600"),children:["send"===e.type?"-":"+",e.amount," ",e.tokenId.toUpperCase()]}),(0,s.jsx)("div",{className:"text-xs px-2 py-1 rounded-full ".concat("confirmed"===e.status?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:e.status})]})]},e.transactionId))})]}),(0,s.jsx)(u,{showRefresh:!0})]})]})})}},81010:(e,t,a)=>{"use strict";a.d(t,{z:()=>s.usePaymentRequest});var s=a(18547)},93095:(e,t,a)=>{"use strict";var s=a(9103);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},e=>{var t=t=>e(e.s=t);e.O(0,[215,960,898,33,412,640,358],()=>t(53845)),_N_E=e.O()}]);
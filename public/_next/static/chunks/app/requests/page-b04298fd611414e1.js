(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[553],{18547:(e,t,a)=>{"use strict";a.r(t),a.d(t,{PaymentRequestProvider:()=>l,usePaymentRequest:()=>u});var s=a(74807),r=a(95423),n=a(53696),c=a(99847);let i=(0,r.createContext)(void 0);function l(e){let{children:t}=e,{user:a}=(0,c.A)(),[l,u]=(0,r.useState)([]),[d,o]=(0,r.useState)(!0),m=async()=>{if(!a){u([]),o(!1);return}o(!0);try{let e=await n.B.getUserPaymentRequests(a.$id);u(e)}catch(e){console.error("Failed to fetch payment requests:",e),u([])}finally{o(!1)}},y=async e=>{if(!a)throw Error("User not authenticated");try{let t="INV-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,8).toUpperCase()),s=e.dueDate||new Date(Date.now()+6048e5).toISOString(),r=await n.B.createPaymentRequest({fromUserId:a.$id,toEmail:e.toEmail,tokenId:e.tokenId,amount:e.amount,description:e.description,dueDate:s,status:"pending",invoiceNumber:t});return await n.B.createSecurityLog({userId:a.$id,action:"payment_request_created",ipAddress:"unknown",success:!0,riskScore:1,metadata:JSON.stringify({requestId:r.requestId,amount:e.amount,tokenId:e.tokenId,invoiceNumber:t})}),await m(),r}catch(e){throw console.error("Failed to create payment request:",e),e}},x=async(e,t)=>{try{await n.B.updatePaymentRequest(e,{status:"paid",paymentTxId:t,paidAt:new Date().toISOString()}),await n.B.createSecurityLog({userId:a.$id,action:"payment_request_paid",ipAddress:"unknown",success:!0,riskScore:0,metadata:JSON.stringify({requestId:e,transactionId:t})}),await m()}catch(e){throw console.error("Failed to pay payment request:",e),e}},h=async e=>{try{await n.B.updatePaymentRequest(e,{status:"cancelled"}),await n.B.createSecurityLog({userId:a.$id,action:"payment_request_cancelled",ipAddress:"unknown",success:!0,riskScore:0,metadata:JSON.stringify({requestId:e})}),await m()}catch(e){throw console.error("Failed to cancel payment request:",e),e}};return(0,r.useEffect)(()=>{m()},[a]),(0,s.jsx)(i.Provider,{value:{paymentRequests:l,isLoading:d,createPaymentRequest:y,payPaymentRequest:x,cancelPaymentRequest:h,refreshPaymentRequests:m,getActiveRequests:()=>l.filter(e=>"pending"===e.status),getPaidRequests:()=>l.filter(e=>"paid"===e.status)},children:t})}function u(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("usePaymentRequest must be used within a PaymentRequestProvider");return e}},49969:(e,t,a)=>{"use strict";a.d(t,{G:()=>r});var s=a(74807);function r(e){let{children:t}=e;return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsx)("main",{children:t})})}a(95423)},53696:(e,t,a)=>{"use strict";a.d(t,{B:()=>r});var s=a(74219);class r{static async createUser(e){let t=new Date().toISOString();return await s.LL.createDocument(s.AH,s.WU.USERS,e.userId,{...e,createdAt:t,updatedAt:t})}static async getUser(e){return await s.LL.getDocument(s.AH,s.WU.USERS,e)}static async updateUser(e,t){return await s.LL.updateDocument(s.AH,s.WU.USERS,e,{...t,updatedAt:new Date().toISOString()})}static async getUserByEmail(e){try{return(await s.LL.listDocuments(s.AH,s.WU.USERS,[s.XK.equal("email",e)])).documents[0]||null}catch(e){return null}}static async getUserByUsername(e){try{return(await s.LL.listDocuments(s.AH,s.WU.USERS,[s.XK.equal("username",e)])).documents[0]||null}catch(e){return null}}static async createWallet(e){let t=s.ID.unique(),a=await s.LL.createDocument(s.AH,s.WU.WALLETS,t,{...e,walletName:e.name,walletAddress:e.address,walletId:t,createdAt:new Date().toISOString()});return a.name=a.walletName,a.address=a.walletAddress,a}static async getUserWallets(e){return(await s.LL.listDocuments(s.AH,s.WU.WALLETS,[s.XK.equal("userId",e),s.XK.equal("isActive",!0),s.XK.orderDesc("createdAt")])).documents.map(e=>({...e,name:e.walletName||e.name,address:e.walletAddress||e.address}))}static async getWallet(e){return await s.LL.getDocument(s.AH,s.WU.WALLETS,e)}static async updateWallet(e,t){return await s.LL.updateDocument(s.AH,s.WU.WALLETS,e,t)}static async setDefaultWallet(e,t){let a=await this.getUserWallets(e);return await Promise.all(a.map(e=>this.updateWallet(e.walletId,{isDefault:!1}))),await this.updateWallet(t,{isDefault:!0})}static async getTokens(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return(await s.LL.listDocuments(s.AH,s.WU.TOKENS,[s.XK.equal("isActive",!0),s.XK.orderAsc("name"),s.XK.limit(e)])).documents}static async getToken(e){return await s.LL.getDocument(s.AH,s.WU.TOKENS,e)}static async getTokenBySymbol(e){try{return(await s.LL.listDocuments(s.AH,s.WU.TOKENS,[s.XK.equal("symbol",e)])).documents[0]||null}catch(e){return null}}static async createTransaction(e){let t=s.ID.unique();return await s.LL.createDocument(s.AH,s.WU.TRANSACTIONS,t,{...e,transactionId:t,createdAt:new Date().toISOString()})}static async getUserTransactions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return(await s.LL.listDocuments(s.AH,s.WU.TRANSACTIONS,[s.XK.or([s.XK.equal("fromUserId",e),s.XK.equal("toUserId",e)]),s.XK.orderDesc("createdAt"),s.XK.limit(t)])).documents}static async getTransaction(e){return await s.LL.getDocument(s.AH,s.WU.TRANSACTIONS,e)}static async updateTransaction(e,t){return await s.LL.updateDocument(s.AH,s.WU.TRANSACTIONS,e,t)}static async createPaymentRequest(e){let t=s.ID.unique();return await s.LL.createDocument(s.AH,s.WU.PAYMENT_REQUESTS,t,{...e,requestId:t,createdAt:new Date().toISOString()})}static async getUserPaymentRequests(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sent";return(await s.LL.listDocuments(s.AH,s.WU.PAYMENT_REQUESTS,[s.XK.equal("sent"===t?"fromUserId":"toUserId",e),s.XK.orderDesc("createdAt")])).documents}static async getPaymentRequest(e){return await s.LL.getDocument(s.AH,s.WU.PAYMENT_REQUESTS,e)}static async updatePaymentRequest(e,t){await s.LL.updateDocument(s.AH,s.WU.PAYMENT_REQUESTS,e,t)}static async getPaymentRequestByInvoice(e){let t=await s.LL.listDocuments(s.AH,s.WU.PAYMENT_REQUESTS,[s.XK.equal("invoiceNumber",e)]);if(0===t.documents.length)throw Error("Payment request not found");return t.documents[0]}static async getExchangeRates(){return(await s.LL.listDocuments(s.AH,s.WU.EXCHANGE_RATES,[s.XK.equal("isActive",!0),s.XK.orderDesc("lastUpdated")])).documents}static async getExchangeRate(e,t){try{return(await s.LL.listDocuments(s.AH,s.WU.EXCHANGE_RATES,[s.XK.equal("fromCurrency",e),s.XK.equal("toCurrency",t),s.XK.equal("isActive",!0)])).documents[0]||null}catch(e){return null}}static async createSecurityLog(e){let t=s.ID.unique();return await s.LL.createDocument(s.AH,s.WU.SECURITY_LOGS,t,{...e,logId:t,createdAt:new Date().toISOString()})}static async getUserSecurityLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return(await s.LL.listDocuments(s.AH,s.WU.SECURITY_LOGS,[s.XK.equal("userId",e),s.XK.orderDesc("createdAt"),s.XK.limit(t)])).documents}static async createAPIKey(e){let t=s.ID.unique();return await s.LL.createDocument(s.AH,s.WU.API_KEYS,t,{...e,keyId:t,createdAt:new Date().toISOString()})}static async getUserAPIKeys(e){return(await s.LL.listDocuments(s.AH,s.WU.API_KEYS,[s.XK.equal("userId",e),s.XK.orderDesc("createdAt")])).documents}static async updateAPIKey(e,t){return await s.LL.updateDocument(s.AH,s.WU.API_KEYS,e,t)}static async deactivateAPIKey(e){return await this.updateAPIKey(e,{isActive:!1})}}},68278:(e,t,a)=>{Promise.resolve().then(a.bind(a,88995))},74219:(e,t,a)=>{"use strict";a.d(t,{AH:()=>i,ID:()=>s.ID,LL:()=>c,WU:()=>l,XK:()=>s.XK,ct:()=>n});var s=a(69960);let r=new s.Kj;r.setEndpoint("https://fra.cloud.appwrite.io/v1").setProject("68399b0c0018d6ce71bc");let n=new s.gD(r),c=new s.Lv(r);new s.wc(r);let i="683a31960011608eaee5",l={USERS:"users",WALLETS:"wallets",TOKENS:"tokens",TRANSACTIONS:"transactions",PAYMENT_REQUESTS:"payment_requests",EXCHANGE_RATES:"exchange_rates",SECURITY_LOGS:"security_logs",API_KEYS:"api_keys"}},81010:(e,t,a)=>{"use strict";a.d(t,{z:()=>s.usePaymentRequest});var s=a(18547)},85430:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AuthProvider:()=>l,useAuth:()=>u});var s=a(74807),r=a(95423),n=a(53696),c=a(74219);let i=(0,r.createContext)(void 0);function l(e){let{children:t}=e,[a,l]=(0,r.useState)(null),[u,d]=(0,r.useState)(null),[o,m]=(0,r.useState)(!0),y=e=>e.split("@")[0].toLowerCase().replace(/[^a-z0-9]/g,""),x=async e=>{try{let t=await n.B.getUser(e.$id);if(t)return d(t),t}catch(e){console.log("Creating new user profile...")}try{let t=y(e.email),a={userId:e.$id,email:e.email,username:t,displayName:e.name||t,kycStatus:"pending",kycLevel:0,twoFactorEnabled:!1,isActive:!0,preferredCurrency:"USD"},s=await n.B.createUser(a);return d(s),await n.B.createSecurityLog({userId:e.$id,action:"profile_created",ipAddress:"unknown",success:!0,riskScore:0}),s}catch(e){throw console.error("Failed to create user profile:",e),e}},h=async()=>{if(a)try{let e=await n.B.getUser(a.$id);d(e)}catch(e){console.error("Failed to refresh profile:",e)}},w=async(e,t)=>{m(!0);try{await c.ct.createEmailPasswordSession(e,t);let a=await c.ct.get();l(a),await x(a),await n.B.createSecurityLog({userId:a.$id,action:"login_success",ipAddress:"unknown",success:!0,riskScore:0})}catch(t){if(e)try{let t=await n.B.getUserByEmail(e);t&&await n.B.createSecurityLog({userId:t.userId,action:"login_failed",ipAddress:"unknown",success:!1,riskScore:3})}catch(e){console.error("Failed to log security event:",e)}throw t}finally{m(!1)}},p=async(e,t,a)=>{m(!0);try{await c.ct.create("unique()",e,t,a),await c.ct.createEmailPasswordSession(e,t);let s=await c.ct.get();l(s),await x(s)}catch(e){throw e}finally{m(!1)}},g=async()=>{try{a&&await n.B.createSecurityLog({userId:a.$id,action:"logout",ipAddress:"unknown",success:!0,riskScore:0}),await c.ct.deleteSession("current"),l(null),d(null)}catch(e){console.error("Logout failed:",e)}};return(0,r.useEffect)(()=>{(async()=>{m(!0);try{let e=await c.ct.get();l(e),await x(e)}catch(e){l(null),d(null)}finally{m(!1)}})()},[]),(0,s.jsx)(i.Provider,{value:{user:a,userProfile:u,isLoading:o,login:w,register:p,logout:g,refreshProfile:h},children:t})}function u(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},88995:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(74807),r=a(95423),n=a(99847),c=a(81010),i=a(49969),l=a(30760),u=a(67138),d=a.n(u);function o(){let{user:e}=(0,n.A)(),{paymentRequests:t,isLoading:a,refreshPaymentRequests:u,cancelPaymentRequest:o}=(0,c.z)(),[m,y]=(0,r.useState)(t),[x,h]=(0,r.useState)("all"),[w,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{g()},[t,x]);let g=()=>{let e=t;switch(x){case"pending":e=t.filter(e=>"pending"===e.status);break;case"paid":e=t.filter(e=>"paid"===e.status);break;case"cancelled":e=t.filter(e=>"cancelled"===e.status);break;case"overdue":let a=new Date;e=t.filter(e=>"pending"===e.status&&e.dueDate&&new Date(e.dueDate)<a);break;default:e=t}y(e)},S=e=>{let t="".concat(window.location.origin,"/pay/").concat(e);navigator.clipboard.writeText(t),p(e),setTimeout(()=>p(null),2e3)},A=async e=>{if(confirm("Are you sure you want to cancel this payment request?"))try{await o(e)}catch(e){console.error("Failed to cancel request:",e)}},f=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),N=e=>{switch(e){case"paid":return"text-green-600 bg-green-100";case"pending":return"text-yellow-600 bg-yellow-100";case"cancelled":return"text-red-600 bg-red-100";default:return"text-neutral-600 bg-neutral-100"}},v=e=>({btc:"BTC",eth:"ETH",matic:"MATIC",bnb:"BNB",usdt:"USDT",usdc:"USDC"})[e]||e.toUpperCase(),L=(e,t)=>"pending"===t&&e&&new Date(e)<new Date;return(0,s.jsx)(i.G,{children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-6 max-w-4xl",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)(d(),{href:"/",className:"inline-flex items-center text-neutral-600 hover:text-neutral-900 mb-4",children:[(0,s.jsx)(l.kRp,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-neutral-900",children:"Payment Requests"}),(0,s.jsx)("p",{className:"text-neutral-600 mt-2",children:"Manage your payment requests and invoices"})]}),(0,s.jsxs)(d(),{href:"/requests/create",className:"flex items-center px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:[(0,s.jsx)(l.GGD,{className:"w-4 h-4 mr-2"}),"Create Request"]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-neutral-200 p-4 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(l.K7R,{className:"w-5 h-5 text-neutral-500"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"All Requests"},{value:"pending",label:"Pending"},{value:"paid",label:"Paid"},{value:"overdue",label:"Overdue"},{value:"cancelled",label:"Cancelled"}].map(e=>(0,s.jsx)("button",{onClick:()=>h(e.value),className:"px-3 py-1 rounded-full text-sm transition-colors ".concat(x===e.value?"bg-cyan-500 text-white":"bg-neutral-100 text-neutral-600 hover:bg-neutral-200"),children:e.label},e.value))})]}),(0,s.jsxs)("div",{className:"mt-2 text-sm text-neutral-500",children:["Showing ",m.length," of ",t.length," requests"]})]}),(0,s.jsx)("div",{className:"bg-white rounded-xl border border-neutral-200",children:a?(0,s.jsxs)("div",{className:"p-8 text-center",children:[(0,s.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-neutral-500",children:"Loading payment requests..."})]}):0===m.length?(0,s.jsxs)("div",{className:"p-8 text-center",children:[(0,s.jsx)("div",{className:"text-neutral-400 mb-4",children:(0,s.jsx)(l.PjK,{className:"w-12 h-12 mx-auto"})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-neutral-700 mb-2",children:"No payment requests found"}),(0,s.jsx)("p",{className:"text-neutral-500 mb-4",children:"all"===x?"You haven't created any payment requests yet":"No ".concat(x," payment requests found")}),(0,s.jsxs)(d(),{href:"/requests/create",className:"inline-flex items-center px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:[(0,s.jsx)(l.GGD,{className:"w-4 h-4 mr-2"}),"Create Your First Request"]})]}):(0,s.jsx)("div",{className:"divide-y divide-neutral-200",children:m.map(e=>(0,s.jsx)("div",{className:"p-6 hover:bg-neutral-50 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,s.jsx)("h3",{className:"font-medium text-neutral-900",children:e.invoiceNumber}),(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(N(e.status)),children:e.status}),L(e.dueDate,e.status)&&(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-red-600 bg-red-100",children:"Overdue"})]}),(0,s.jsxs)("div",{className:"text-2xl font-bold text-neutral-900 mb-2",children:[e.amount," ",v(e.tokenId)]}),e.description&&(0,s.jsx)("p",{className:"text-neutral-600 mb-2",children:e.description}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-neutral-500",children:[(0,s.jsxs)("span",{children:["Created: ",f(e.createdAt)]}),(0,s.jsxs)("span",{children:["Due: ",e.dueDate?f(e.dueDate):"No due date"]}),e.toEmail&&(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)(l.pHD,{className:"w-3 h-3 mr-1"}),e.toEmail]})]}),e.paidAt&&(0,s.jsxs)("div",{className:"text-sm text-green-600 mt-1",children:["Paid on ",f(e.paidAt)]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:["pending"===e.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>S(e.requestId),className:"flex items-center px-3 py-1 bg-neutral-100 text-neutral-700 rounded-lg hover:bg-neutral-200 transition-colors text-sm",children:w===e.requestId?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.YrT,{className:"w-3 h-3 mr-1"}),"Copied"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.nxz,{className:"w-3 h-3 mr-1"}),"Copy Link"]})}),(0,s.jsxs)(d(),{href:"/pay/".concat(e.requestId),className:"flex items-center px-3 py-1 bg-cyan-100 text-cyan-700 rounded-lg hover:bg-cyan-200 transition-colors text-sm",children:[(0,s.jsx)(l.HaR,{className:"w-3 h-3 mr-1"}),"View"]}),(0,s.jsxs)("button",{onClick:()=>A(e.requestId),className:"flex items-center px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm",children:[(0,s.jsx)(l.yGN,{className:"w-3 h-3 mr-1"}),"Cancel"]})]}),"paid"===e.status&&e.paymentTxId&&(0,s.jsxs)(d(),{href:"/transactions",className:"flex items-center px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors text-sm",children:[(0,s.jsx)(l.HaR,{className:"w-3 h-3 mr-1"}),"View Payment"]})]})]})},e.requestId))})})]})})}},99847:(e,t,a)=>{"use strict";a.d(t,{A:()=>s.useAuth,O:()=>s.AuthProvider});var s=a(85430)}},e=>{var t=t=>e(e.s=t);e.O(0,[215,960,898,412,640,358],()=>t(68278)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[910],{18547:(e,t,a)=>{"use strict";a.r(t),a.d(t,{PaymentRequestProvider:()=>l,usePaymentRequest:()=>u});var s=a(74807),r=a(95423),n=a(53696),c=a(99847);let i=(0,r.createContext)(void 0);function l(e){let{children:t}=e,{user:a}=(0,c.A)(),[l,u]=(0,r.useState)([]),[o,d]=(0,r.useState)(!0),m=async()=>{if(!a){u([]),d(!1);return}d(!0);try{let e=await n.B.getUserPaymentRequests(a.$id);u(e)}catch(e){console.error("Failed to fetch payment requests:",e),u([])}finally{d(!1)}},y=async e=>{if(!a)throw Error("User not authenticated");try{let t="INV-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,8).toUpperCase()),s=e.dueDate||new Date(Date.now()+6048e5).toISOString(),r=await n.B.createPaymentRequest({fromUserId:a.$id,toEmail:e.toEmail,tokenId:e.tokenId,amount:e.amount,description:e.description,dueDate:s,status:"pending",invoiceNumber:t});return await n.B.createSecurityLog({userId:a.$id,action:"payment_request_created",ipAddress:"unknown",success:!0,riskScore:1,metadata:JSON.stringify({requestId:r.requestId,amount:e.amount,tokenId:e.tokenId,invoiceNumber:t})}),await m(),r}catch(e){throw console.error("Failed to create payment request:",e),e}},h=async(e,t)=>{try{await n.B.updatePaymentRequest(e,{status:"paid",paymentTxId:t,paidAt:new Date().toISOString()}),await n.B.createSecurityLog({userId:a.$id,action:"payment_request_paid",ipAddress:"unknown",success:!0,riskScore:0,metadata:JSON.stringify({requestId:e,transactionId:t})}),await m()}catch(e){throw console.error("Failed to pay payment request:",e),e}},p=async e=>{try{await n.B.updatePaymentRequest(e,{status:"cancelled"}),await n.B.createSecurityLog({userId:a.$id,action:"payment_request_cancelled",ipAddress:"unknown",success:!0,riskScore:0,metadata:JSON.stringify({requestId:e})}),await m()}catch(e){throw console.error("Failed to cancel payment request:",e),e}};return(0,r.useEffect)(()=>{m()},[a]),(0,s.jsx)(i.Provider,{value:{paymentRequests:l,isLoading:o,createPaymentRequest:y,payPaymentRequest:h,cancelPaymentRequest:p,refreshPaymentRequests:m,getActiveRequests:()=>l.filter(e=>"pending"===e.status),getPaidRequests:()=>l.filter(e=>"paid"===e.status)},children:t})}function u(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("usePaymentRequest must be used within a PaymentRequestProvider");return e}},49969:(e,t,a)=>{"use strict";a.d(t,{G:()=>r});var s=a(74807);function r(e){let{children:t}=e;return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsx)("main",{children:t})})}a(95423)},53696:(e,t,a)=>{"use strict";a.d(t,{B:()=>r});var s=a(74219);class r{static async createUser(e){let t=new Date().toISOString();return await s.LL.createDocument(s.AH,s.WU.USERS,e.userId,{...e,createdAt:t,updatedAt:t})}static async getUser(e){return await s.LL.getDocument(s.AH,s.WU.USERS,e)}static async updateUser(e,t){return await s.LL.updateDocument(s.AH,s.WU.USERS,e,{...t,updatedAt:new Date().toISOString()})}static async getUserByEmail(e){try{return(await s.LL.listDocuments(s.AH,s.WU.USERS,[s.XK.equal("email",e)])).documents[0]||null}catch(e){return null}}static async getUserByUsername(e){try{return(await s.LL.listDocuments(s.AH,s.WU.USERS,[s.XK.equal("username",e)])).documents[0]||null}catch(e){return null}}static async createWallet(e){let t=s.ID.unique(),a=await s.LL.createDocument(s.AH,s.WU.WALLETS,t,{...e,walletName:e.name,walletAddress:e.address,walletId:t,createdAt:new Date().toISOString()});return a.name=a.walletName,a.address=a.walletAddress,a}static async getUserWallets(e){return(await s.LL.listDocuments(s.AH,s.WU.WALLETS,[s.XK.equal("userId",e),s.XK.equal("isActive",!0),s.XK.orderDesc("createdAt")])).documents.map(e=>({...e,name:e.walletName||e.name,address:e.walletAddress||e.address}))}static async getWallet(e){return await s.LL.getDocument(s.AH,s.WU.WALLETS,e)}static async updateWallet(e,t){return await s.LL.updateDocument(s.AH,s.WU.WALLETS,e,t)}static async setDefaultWallet(e,t){let a=await this.getUserWallets(e);return await Promise.all(a.map(e=>this.updateWallet(e.walletId,{isDefault:!1}))),await this.updateWallet(t,{isDefault:!0})}static async getTokens(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return(await s.LL.listDocuments(s.AH,s.WU.TOKENS,[s.XK.equal("isActive",!0),s.XK.orderAsc("name"),s.XK.limit(e)])).documents}static async getToken(e){return await s.LL.getDocument(s.AH,s.WU.TOKENS,e)}static async getTokenBySymbol(e){try{return(await s.LL.listDocuments(s.AH,s.WU.TOKENS,[s.XK.equal("symbol",e)])).documents[0]||null}catch(e){return null}}static async createTransaction(e){let t=s.ID.unique();return await s.LL.createDocument(s.AH,s.WU.TRANSACTIONS,t,{...e,transactionId:t,createdAt:new Date().toISOString()})}static async getUserTransactions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return(await s.LL.listDocuments(s.AH,s.WU.TRANSACTIONS,[s.XK.or([s.XK.equal("fromUserId",e),s.XK.equal("toUserId",e)]),s.XK.orderDesc("createdAt"),s.XK.limit(t)])).documents}static async getTransaction(e){return await s.LL.getDocument(s.AH,s.WU.TRANSACTIONS,e)}static async updateTransaction(e,t){return await s.LL.updateDocument(s.AH,s.WU.TRANSACTIONS,e,t)}static async createPaymentRequest(e){let t=s.ID.unique();return await s.LL.createDocument(s.AH,s.WU.PAYMENT_REQUESTS,t,{...e,requestId:t,createdAt:new Date().toISOString()})}static async getUserPaymentRequests(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sent";return(await s.LL.listDocuments(s.AH,s.WU.PAYMENT_REQUESTS,[s.XK.equal("sent"===t?"fromUserId":"toUserId",e),s.XK.orderDesc("createdAt")])).documents}static async getPaymentRequest(e){return await s.LL.getDocument(s.AH,s.WU.PAYMENT_REQUESTS,e)}static async updatePaymentRequest(e,t){await s.LL.updateDocument(s.AH,s.WU.PAYMENT_REQUESTS,e,t)}static async getPaymentRequestByInvoice(e){let t=await s.LL.listDocuments(s.AH,s.WU.PAYMENT_REQUESTS,[s.XK.equal("invoiceNumber",e)]);if(0===t.documents.length)throw Error("Payment request not found");return t.documents[0]}static async getExchangeRates(){return(await s.LL.listDocuments(s.AH,s.WU.EXCHANGE_RATES,[s.XK.equal("isActive",!0),s.XK.orderDesc("lastUpdated")])).documents}static async getExchangeRate(e,t){try{return(await s.LL.listDocuments(s.AH,s.WU.EXCHANGE_RATES,[s.XK.equal("fromCurrency",e),s.XK.equal("toCurrency",t),s.XK.equal("isActive",!0)])).documents[0]||null}catch(e){return null}}static async createSecurityLog(e){let t=s.ID.unique();return await s.LL.createDocument(s.AH,s.WU.SECURITY_LOGS,t,{...e,logId:t,createdAt:new Date().toISOString()})}static async getUserSecurityLogs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return(await s.LL.listDocuments(s.AH,s.WU.SECURITY_LOGS,[s.XK.equal("userId",e),s.XK.orderDesc("createdAt"),s.XK.limit(t)])).documents}static async createAPIKey(e){let t=s.ID.unique();return await s.LL.createDocument(s.AH,s.WU.API_KEYS,t,{...e,keyId:t,createdAt:new Date().toISOString()})}static async getUserAPIKeys(e){return(await s.LL.listDocuments(s.AH,s.WU.API_KEYS,[s.XK.equal("userId",e),s.XK.orderDesc("createdAt")])).documents}static async updateAPIKey(e,t){return await s.LL.updateDocument(s.AH,s.WU.API_KEYS,e,t)}static async deactivateAPIKey(e){return await this.updateAPIKey(e,{isActive:!1})}}},62988:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var s=a(74807),r=a(95423),n=a(93095),c=a(99847),i=a(81010),l=a(49969),u=a(30760),o=a(67138),d=a.n(o);function m(){var e;let t=(0,n.useRouter)(),{user:a}=(0,c.A)(),{createPaymentRequest:o}=(0,i.z)(),[m,y]=(0,r.useState)(!1),[h,p]=(0,r.useState)(""),[w,x]=(0,r.useState)(""),[g,S]=(0,r.useState)({toEmail:"",tokenId:"btc",amount:"",description:"",dueDate:""}),f=async e=>{if(e.preventDefault(),a){y(!0),x(""),p("");try{let e=await o(g);p("Payment request created! Invoice: ".concat(e.invoiceNumber)),S({toEmail:"",tokenId:"btc",amount:"",description:"",dueDate:""}),setTimeout(()=>{t.push("/requests")},3e3)}catch(e){x(e.message||"Failed to create payment request")}finally{y(!1)}}},A=()=>g.amount&&parseFloat(g.amount)>0,b=[{id:"btc",name:"Bitcoin",symbol:"BTC"},{id:"eth",name:"Ethereum",symbol:"ETH"},{id:"matic",name:"Polygon",symbol:"MATIC"},{id:"bnb",name:"BNB",symbol:"BNB"},{id:"usdt",name:"Tether USD",symbol:"USDT"},{id:"usdc",name:"USD Coin",symbol:"USDC"}];return(0,s.jsx)(l.G,{children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)(d(),{href:"/requests",className:"inline-flex items-center text-neutral-600 hover:text-neutral-900 mb-4",children:[(0,s.jsx)(u.kRp,{className:"w-4 h-4 mr-2"}),"Back to Payment Requests"]}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-neutral-900",children:"Create Payment Request"}),(0,s.jsx)("p",{className:"text-neutral-600 mt-2",children:"Generate an invoice and request payment from someone"})]}),w&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(u.y3G,{className:"w-5 h-5 text-red-500 mr-2"}),(0,s.jsx)("span",{className:"text-red-700",children:w})]})}),h&&(0,s.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(u.YrT,{className:"w-5 h-5 text-green-500 mr-2"}),(0,s.jsx)("span",{className:"text-green-700",children:h})]})}),(0,s.jsxs)("form",{onSubmit:f,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-neutral-200 p-6",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[(0,s.jsx)(u.pHD,{className:"w-4 h-4 inline mr-2"}),"Recipient Email (Optional)"]}),(0,s.jsx)("input",{type:"email",value:g.toEmail,onChange:e=>S({...g,toEmail:e.target.value}),placeholder:"recipient@example.com",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"}),(0,s.jsx)("p",{className:"text-sm text-neutral-500 mt-2",children:"If provided, we'll send the payment request link to this email"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-neutral-200 p-6",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[(0,s.jsx)(u.z8N,{className:"w-4 h-4 inline mr-2"}),"Token"]}),(0,s.jsx)("select",{value:g.tokenId,onChange:e=>S({...g,tokenId:e.target.value}),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent",required:!0,children:b.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (",e.symbol,")"]},e.id))})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-neutral-200 p-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Amount"}),(0,s.jsx)("input",{type:"number",step:"0.000001",min:"0",required:!0,value:g.amount,onChange:e=>S({...g,amount:e.target.value}),placeholder:"0.00",className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"}),(0,s.jsx)("p",{className:"text-sm text-neutral-500 mt-2",children:"The amount you want to request"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-neutral-200 p-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Description"}),(0,s.jsx)("textarea",{value:g.description,onChange:e=>S({...g,description:e.target.value}),placeholder:"What is this payment for?",rows:3,className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"}),(0,s.jsx)("p",{className:"text-sm text-neutral-500 mt-2",children:"Describe what this payment is for"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border border-neutral-200 p-6",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:[(0,s.jsx)(u.wIk,{className:"w-4 h-4 inline mr-2"}),"Due Date (Optional)"]}),(0,s.jsx)("input",{type:"date",value:g.dueDate,onChange:e=>S({...g,dueDate:e.target.value}),min:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"}),(0,s.jsx)("p",{className:"text-sm text-neutral-500 mt-2",children:"When should this payment be made? Default is 7 days from now"})]}),A()&&(0,s.jsxs)("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-6",children:[(0,s.jsxs)("h3",{className:"font-medium text-cyan-900 mb-3",children:[(0,s.jsx)(u.PjK,{className:"w-4 h-4 inline mr-2"}),"Payment Request Preview"]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-cyan-700",children:"Amount:"}),(0,s.jsxs)("span",{className:"font-medium text-cyan-900",children:[g.amount," ",null==(e=b.find(e=>e.id===g.tokenId))?void 0:e.symbol]})]}),g.description&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-cyan-700",children:"Description:"}),(0,s.jsx)("span",{className:"font-medium text-cyan-900",children:g.description})]}),g.toEmail&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-cyan-700",children:"Recipient:"}),(0,s.jsx)("span",{className:"font-medium text-cyan-900",children:g.toEmail})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-cyan-700",children:"Due Date:"}),(0,s.jsx)("span",{className:"font-medium text-cyan-900",children:g.dueDate||(()=>{let e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]})()})]})]})]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(d(),{href:"/requests",className:"flex-1 px-4 py-2 border border-neutral-300 text-neutral-700 rounded-lg hover:bg-neutral-50 transition-colors text-center",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:m||!A(),className:"flex-1 px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:m?"Creating...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.PjK,{className:"w-4 h-4 mr-2"}),"Create Request"]})})]})]})]})})}},74219:(e,t,a)=>{"use strict";a.d(t,{AH:()=>i,ID:()=>s.ID,LL:()=>c,WU:()=>l,XK:()=>s.XK,ct:()=>n});var s=a(69960);let r=new s.Kj;r.setEndpoint("https://fra.cloud.appwrite.io/v1").setProject("68399b0c0018d6ce71bc");let n=new s.gD(r),c=new s.Lv(r);new s.wc(r);let i="683a31960011608eaee5",l={USERS:"users",WALLETS:"wallets",TOKENS:"tokens",TRANSACTIONS:"transactions",PAYMENT_REQUESTS:"payment_requests",EXCHANGE_RATES:"exchange_rates",SECURITY_LOGS:"security_logs",API_KEYS:"api_keys"}},81010:(e,t,a)=>{"use strict";a.d(t,{z:()=>s.usePaymentRequest});var s=a(18547)},85430:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AuthProvider:()=>l,useAuth:()=>u});var s=a(74807),r=a(95423),n=a(53696),c=a(74219);let i=(0,r.createContext)(void 0);function l(e){let{children:t}=e,[a,l]=(0,r.useState)(null),[u,o]=(0,r.useState)(null),[d,m]=(0,r.useState)(!0),y=e=>e.split("@")[0].toLowerCase().replace(/[^a-z0-9]/g,""),h=async e=>{try{let t=await n.B.getUser(e.$id);if(t)return o(t),t}catch(e){console.log("Creating new user profile...")}try{let t=y(e.email),a={userId:e.$id,email:e.email,username:t,displayName:e.name||t,kycStatus:"pending",kycLevel:0,twoFactorEnabled:!1,isActive:!0,preferredCurrency:"USD"},s=await n.B.createUser(a);return o(s),await n.B.createSecurityLog({userId:e.$id,action:"profile_created",ipAddress:"unknown",success:!0,riskScore:0}),s}catch(e){throw console.error("Failed to create user profile:",e),e}},p=async()=>{if(a)try{let e=await n.B.getUser(a.$id);o(e)}catch(e){console.error("Failed to refresh profile:",e)}},w=async(e,t)=>{m(!0);try{await c.ct.createEmailPasswordSession(e,t);let a=await c.ct.get();l(a),await h(a),await n.B.createSecurityLog({userId:a.$id,action:"login_success",ipAddress:"unknown",success:!0,riskScore:0})}catch(t){if(e)try{let t=await n.B.getUserByEmail(e);t&&await n.B.createSecurityLog({userId:t.userId,action:"login_failed",ipAddress:"unknown",success:!1,riskScore:3})}catch(e){console.error("Failed to log security event:",e)}throw t}finally{m(!1)}},x=async(e,t,a)=>{m(!0);try{await c.ct.create("unique()",e,t,a),await c.ct.createEmailPasswordSession(e,t);let s=await c.ct.get();l(s),await h(s)}catch(e){throw e}finally{m(!1)}},g=async()=>{try{a&&await n.B.createSecurityLog({userId:a.$id,action:"logout",ipAddress:"unknown",success:!0,riskScore:0}),await c.ct.deleteSession("current"),l(null),o(null)}catch(e){console.error("Logout failed:",e)}};return(0,r.useEffect)(()=>{(async()=>{m(!0);try{let e=await c.ct.get();l(e),await h(e)}catch(e){l(null),o(null)}finally{m(!1)}})()},[]),(0,s.jsx)(i.Provider,{value:{user:a,userProfile:u,isLoading:d,login:w,register:x,logout:g,refreshProfile:p},children:t})}function u(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},93095:(e,t,a)=>{"use strict";var s=a(9103);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},94407:(e,t,a)=>{Promise.resolve().then(a.bind(a,62988))},99847:(e,t,a)=>{"use strict";a.d(t,{A:()=>s.useAuth,O:()=>s.AuthProvider});var s=a(85430)}},e=>{var t=t=>e(e.s=t);e.O(0,[215,960,898,412,640,358],()=>t(94407)),_N_E=e.O()}]);